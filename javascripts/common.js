import{render,showWhile,getBase64}from"./util.js";class Image{constructor(e,t){this.file=e,this.seq=t,this.base64=null}async setBase64(){this.base64=await getBase64(this.file)}}class Previewer{constructor(e,t){this.slider=e,this.uploadItem=t,this.images=[]}async appendImages(e){const t=[],i=this.images.length+1;for(const a in e){const s=e[a],r=new Image(s,i+Number(a));await r.setBase64(),t.push(r)}if(this.images=[...this.images,...t],"byName"===getSortType()){const e=sortImageByName(this.images);e.forEach(((e,t)=>e.seq=t+1)),this.images=e}}preview(){clearPreviewElement(),this.images.forEach((e=>{this.create(e)}))}create(e){const t=e.file.name,i=e.seq,a=e.base64,s=document.createElement("div"),r=document.createElement("div"),l=document.createElement("div"),n=document.createElement("img"),c=document.createElement("div"),o=document.createElement("div");l.classList.add("remove-icon"),l.dataset.seq=i,l.onclick=()=>this.remove(i),r.classList.add("preview-image"),r.style.backgroundImage=`url('${a}')`,r.appendChild(l),n.classList.add("real-image","hide"),n.src=a,c.classList.add("file-seq"),c.innerText=i,o.classList.add("file-name"),o.innerText=t,s.classList.add("image-container"),s.appendChild(r),s.appendChild(n),s.appendChild(c),s.appendChild(o),render(this.uploadItem,s,"beforebegin"),this.slider.scrollLeft=this.slider.scrollWidth}remove(e){this.images=this.images.filter((t=>t.seq!==e)),this.images.forEach(((e,t)=>e.seq=t+1)),this.preview()}clear(){this.images=[],clearPreviewElement(),hideResultArea()}}window.addEventListener("load",(()=>{const e=new Previewer(document.querySelector(".preview-area"),document.querySelector(".preview-area .upload-item"));document.querySelector("#addFileButton").addEventListener("click",triggerUpload),document.querySelector("#clearButton").addEventListener("click",e.clear.bind(e)),document.querySelector("#submitButton").addEventListener("click",pingtu),document.querySelector("#uploadFile").addEventListener("change",(function(){uploadNewFile(this,e)}))}));const pingtu=()=>{const e=document.querySelector("#resultImage");if(e.getContext){const t=document.querySelectorAll(".real-image"),i=e.getContext("2d");let a=0,s=0,r=0,l=0;t.length>0?(t.forEach((e=>{r=e.height,l=e.width,s=l>s?l:s,a+=r})),e.height=a,e.width=s,a=0,s=0,t.forEach((e=>{r=e.height,l=e.width,i.drawImage(e,s,a,l,r),a+=r})),showResultArea(),showWhile("welldone")):showWhile("nothing")}else alert("網站目前不支援您的瀏覽器")},triggerUpload=()=>{document.querySelector(".input-area input[type=file]").click()},getSortType=()=>document.querySelector('input[type=radio][name="sort"]:checked').value,hideResultArea=()=>{document.querySelector(".result-area").classList.add("hide")},showResultArea=()=>{document.querySelector(".result-area").classList.remove("hide")},clearPreviewElement=()=>{document.querySelectorAll(".image-container").forEach((e=>{e.remove()}))},uploadNewFile=async(e,t)=>{e.files.length>0&&(await t.appendImages([...e.files]),t.preview())},sortImageByName=e=>e.sort(((e,t)=>Number(e.file.name.replace(/\D/g,""))-Number(t.file.name.replace(/\D/g,""))));